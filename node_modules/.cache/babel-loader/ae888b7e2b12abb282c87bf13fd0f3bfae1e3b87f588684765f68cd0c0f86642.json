{"ast":null,"code":"var _jsxFileName = \"/Users/developmentsigncast.ca/Desktop/caster-final/src/components/Player/Player.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport socket, { requestState, joinSession } from \"../../services/socketService\";\n\n// Player component - minimal UI for displaying media with minimal synchronization\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Player() {\n  _s();\n  const [currentItem, setCurrentItem] = useState(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [volume, setVolume] = useState(1);\n  const [isCasting, setIsCasting] = useState(false);\n  const mediaRef = useRef(null);\n  const initialSyncDoneRef = useRef(false);\n\n  // Check URL for session ID on initial load\n  useEffect(() => {\n    const searchParams = new URLSearchParams(window.location.search);\n    const sessionId = searchParams.get('session');\n    console.log(\"Player detected session ID:\", sessionId);\n    if (sessionId) {\n      joinSession(sessionId);\n    } else {\n      requestState();\n    }\n  }, []);\n\n  // Effect to handle socket events from Caster\n  useEffect(() => {\n    socket.on(\"casting_state\", data => {\n      console.log(\"Received casting state:\", data);\n      setIsCasting(data.isCasting);\n      if (data.isCasting) {\n        // Update all state if casting is active\n        if (data.currentItem) setCurrentItem(data.currentItem);\n        if (data.isPlaying !== undefined) setIsPlaying(data.isPlaying);\n        if (data.volume !== undefined) setVolume(data.volume);\n\n        // Only set initial time once when first loading a video\n        if (data.currentTime !== undefined && !initialSyncDoneRef.current && mediaRef.current) {\n          mediaRef.current.currentTime = data.currentTime;\n          initialSyncDoneRef.current = true;\n        }\n      } else {\n        // Reset state if casting is stopped\n        setCurrentItem(null);\n        setIsPlaying(false);\n        initialSyncDoneRef.current = false;\n      }\n    });\n    socket.on(\"media_change\", data => {\n      console.log(\"Media changed:\", data);\n      setCurrentItem(data.item);\n      setIsPlaying(data.isPlaying);\n      initialSyncDoneRef.current = false;\n    });\n    socket.on(\"playback_state\", data => {\n      console.log(\"Playback state changed:\", data.isPlaying);\n      setIsPlaying(data.isPlaying);\n    });\n\n    // IMPORTANT: No time_update handler - letting the video play naturally\n\n    socket.on(\"volume_change\", data => {\n      console.log(\"Volume changed:\", data.volume);\n      setVolume(data.volume);\n      if (mediaRef.current) {\n        mediaRef.current.volume = data.volume;\n      }\n    });\n    return () => {\n      socket.off(\"casting_state\");\n      socket.off(\"media_change\");\n      socket.off(\"playback_state\");\n      socket.off(\"volume_change\");\n    };\n  }, []);\n\n  // Effect to sync media playback state\n  useEffect(() => {\n    if (mediaRef.current) {\n      if (isPlaying) {\n        console.log(\"Attempting to play video...\");\n        mediaRef.current.play().then(() => {\n          console.log(\"Playback started successfully\");\n        }).catch(e => {\n          console.error(\"Playback error:\", e);\n        });\n      } else {\n        mediaRef.current.pause();\n      }\n    }\n  }, [isPlaying, currentItem]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"h-screen w-screen bg-black flex flex-col relative\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 flex items-center justify-center overflow-hidden\",\n      children: isCasting ? currentItem && currentItem.type === \"video\" ? /*#__PURE__*/_jsxDEV(\"video\", {\n        ref: mediaRef,\n        src: currentItem.path,\n        className: \"max-h-full max-w-full\",\n        preload: \"auto\",\n        playsInline: true\n        // No event handlers that could interfere with smooth playback\n        ,\n        onError: e => console.error(\"Video error:\", e)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 13\n      }, this) : currentItem && currentItem.type === \"image\" ? /*#__PURE__*/_jsxDEV(\"img\", {\n        src: currentItem.path,\n        alt: currentItem.name,\n        className: \"max-h-full max-w-full object-contain\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 13\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-gray-500\",\n        children: \"Waiting for media...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 13\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center p-8\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-4xl text-gray-500 mb-4\",\n          children: \"Waiting for Cast\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-400\",\n          children: \"The caster needs to press \\\"Start Casting\\\" to begin streaming content to this player.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this);\n}\n_s(Player, \"Wy/K0Gw9gRj6hR6N6fU8bQlDOZw=\");\n_c = Player;\nvar _c;\n$RefreshReg$(_c, \"Player\");","map":{"version":3,"names":["React","useState","useEffect","useRef","socket","requestState","joinSession","jsxDEV","_jsxDEV","Player","_s","currentItem","setCurrentItem","isPlaying","setIsPlaying","volume","setVolume","isCasting","setIsCasting","mediaRef","initialSyncDoneRef","searchParams","URLSearchParams","window","location","search","sessionId","get","console","log","on","data","undefined","currentTime","current","item","off","play","then","catch","e","error","pause","className","children","type","ref","src","path","preload","playsInline","onError","fileName","_jsxFileName","lineNumber","columnNumber","alt","name","_c","$RefreshReg$"],"sources":["/Users/developmentsigncast.ca/Desktop/caster-final/src/components/Player/Player.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport socket, { requestState, joinSession } from \"../../services/socketService\";\n\n// Player component - minimal UI for displaying media with minimal synchronization\nexport default function Player() {\n  const [currentItem, setCurrentItem] = useState(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [volume, setVolume] = useState(1);\n  const [isCasting, setIsCasting] = useState(false);\n  const mediaRef = useRef(null);\n  const initialSyncDoneRef = useRef(false);\n\n  // Check URL for session ID on initial load\n  useEffect(() => {\n    const searchParams = new URLSearchParams(window.location.search);\n    const sessionId = searchParams.get('session');\n    \n    console.log(\"Player detected session ID:\", sessionId);\n    \n    if (sessionId) {\n      joinSession(sessionId);\n    } else {\n      requestState();\n    }\n  }, []);\n\n  // Effect to handle socket events from Caster\n  useEffect(() => {\n    socket.on(\"casting_state\", (data) => {\n      console.log(\"Received casting state:\", data);\n      setIsCasting(data.isCasting);\n\n      if (data.isCasting) {\n        // Update all state if casting is active\n        if (data.currentItem) setCurrentItem(data.currentItem);\n        if (data.isPlaying !== undefined) setIsPlaying(data.isPlaying);\n        if (data.volume !== undefined) setVolume(data.volume);\n        \n        // Only set initial time once when first loading a video\n        if (data.currentTime !== undefined && !initialSyncDoneRef.current && mediaRef.current) {\n          mediaRef.current.currentTime = data.currentTime;\n          initialSyncDoneRef.current = true;\n        }\n      } else {\n        // Reset state if casting is stopped\n        setCurrentItem(null);\n        setIsPlaying(false);\n        initialSyncDoneRef.current = false;\n      }\n    });\n\n    socket.on(\"media_change\", (data) => {\n      console.log(\"Media changed:\", data);\n      setCurrentItem(data.item);\n      setIsPlaying(data.isPlaying);\n      initialSyncDoneRef.current = false;\n    });\n    \n    socket.on(\"playback_state\", (data) => {\n      console.log(\"Playback state changed:\", data.isPlaying);\n      setIsPlaying(data.isPlaying);\n    });\n\n    // IMPORTANT: No time_update handler - letting the video play naturally\n\n    socket.on(\"volume_change\", (data) => {\n      console.log(\"Volume changed:\", data.volume);\n      setVolume(data.volume);\n      if (mediaRef.current) {\n        mediaRef.current.volume = data.volume;\n      }\n    });\n\n    return () => {\n      socket.off(\"casting_state\");\n      socket.off(\"media_change\");\n      socket.off(\"playback_state\");\n      socket.off(\"volume_change\");\n    };\n  }, []);\n\n  // Effect to sync media playback state\n  useEffect(() => {\n    if (mediaRef.current) {\n      if (isPlaying) {\n        console.log(\"Attempting to play video...\");\n        mediaRef.current.play()\n          .then(() => {\n            console.log(\"Playback started successfully\");\n          })\n          .catch((e) => {\n            console.error(\"Playback error:\", e);\n          });\n      } else {\n        mediaRef.current.pause();\n      }\n    }\n  }, [isPlaying, currentItem]);\n\n  return (\n    <div className=\"h-screen w-screen bg-black flex flex-col relative\">\n      <div className=\"flex-1 flex items-center justify-center overflow-hidden\">\n        {isCasting ? (\n          currentItem && currentItem.type === \"video\" ? (\n            <video\n              ref={mediaRef}\n              src={currentItem.path}\n              className=\"max-h-full max-w-full\"\n              preload=\"auto\"\n              playsInline\n              // No event handlers that could interfere with smooth playback\n              onError={(e) => console.error(\"Video error:\", e)}\n            />\n          ) : currentItem && currentItem.type === \"image\" ? (\n            <img\n              src={currentItem.path}\n              alt={currentItem.name}\n              className=\"max-h-full max-w-full object-contain\"\n            />\n          ) : (\n            <div className=\"text-gray-500\">Waiting for media...</div>\n          )\n        ) : (\n          <div className=\"text-center p-8\">\n            <div className=\"text-4xl text-gray-500 mb-4\">Waiting for Cast</div>\n            <p className=\"text-gray-400\">\n              The caster needs to press \"Start Casting\" to begin streaming content\n              to this player.\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}